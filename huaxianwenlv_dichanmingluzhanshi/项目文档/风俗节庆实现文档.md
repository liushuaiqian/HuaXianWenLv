# 风俗节庆（/customs, /customs/:id）实现文档

## 1. 页面功能描述
- 列表页：支持关键词搜索、月份/季节/类型筛选，卡片展示时间、地点、标签
- 详情页：展示流程、寓意、媒体（图片/视频），最佳观赏时间/地点等

## 2. 核心实现逻辑

### 2.1 列表页搜索与筛选
- 本地数据源：/public/data/customs.json
- 使用 fuse.js 实现模糊搜索，索引字段：title、tags、summary
- URL Query 同步筛选状态，刷新后恢复

```javascript
import Fuse from 'fuse.js'

const options = { keys: ['title', 'tags', 'summary'], threshold: 0.35 }
const fuse = new Fuse(customsData, options)

const query = reactive({ q: '', month: '', season: '', type: '' })

const results = computed(() => {
  let list = customsData
  if (query.q) list = fuse.search(query.q).map(r => r.item)
  if (query.month) list = list.filter(i => i.dateRule.includes(query.month))
  if (query.season) list = list.filter(i => i.season === query.season)
  if (query.type) list = list.filter(i => i.tags?.includes(query.type))
  return list
})

watch(query, (val) => updateUrlQuery(val), { deep: true })
```

### 2.2 详情页加载 Markdown
- 字段 descriptionMd 指向 /content/customs/*.md

```javascript
import MarkdownIt from 'markdown-it'

const md = new MarkdownIt()
const content = ref('')

onMounted(async () => {
  const item = await loadCustomById(route.params.id)
  const mdText = await fetch(item.descriptionMd).then(r => r.text())
  content.value = md.render(mdText)
})
```

### 2.3 媒体展示与灯箱/视频
- 图片使用 ImageLazy 组件，点击进入 Lightbox
- 视频使用 VideoPlayer 组件（支持 poster/subtitles）

## 3. 关键代码片段

```vue
<!-- CustomsList.vue -->
<template>
  <div>
    <FilterBar :categories="types" :regions="[]" :levels="[]" @change="onFilterChange" />
    <SearchBox v-model="query.q" placeholder="搜索风俗与节庆" />
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-6">
      <CustomCard v-for="c in results" :key="c.id" :data="c" />
    </div>
  </div>
</template>
```

```vue
<!-- CustomsDetail.vue -->
<template>
  <article class="prose mx-auto">
    <header>
      <h1 class="text-3xl font-bold">{{ item.title }}</h1>
      <p class="text-gray-600">{{ item.dateRule }} · {{ item.location }}</p>
      <Tag v-for="t in item.tags" :key="t" :label="t" />
    </header>
    <section v-html="content" class="mt-6"></section>
    <MediaGallery :items="item.images" />
    <VideoPlayer v-if="item.video" v-bind="item.video" />
  </article>
</template>
```

## 4. 依赖关系说明
- 数据：/public/data/customs.json
- 内容：/content/customs/*.md
- 组件：SearchBox、FilterBar、CustomCard、ImageLazy、Lightbox、VideoPlayer
- 库：fuse.js、markdown-it

## 5. 注意事项
- 日期规则解析需考虑农历/节气（如仅展示文本）
- 灯箱需支持 ESC 关闭与左右切换
- URL Query 同步与刷新恢复必须正确
- SEO：详情页应设置独立 title/description，支持结构化数据 Article


---

# 规划补充（供布局审核）

1. 清晰的界面结构示意图
- 列表页（/customs）
```
[全局Header/Nav]
    └─ 链接：文化概况｜风俗节庆｜非遗名录｜图文与视频｜地图与路线｜关于
[页面头部]
    ├─ 标题：风俗节庆
    └─ 工具栏 Toolbar（自左向右，可换行）
       [搜索框] [月份选择] [季节选择] [类型选择] [排序]
[内容区 Content]
    └─ 响应式网格（1/2/3列）
       └─ 卡片 Card × N
          ├─ 封面图
          ├─ 标题
          ├─ 基础信息：dateRule（时间规则）· location（地点）
          └─ 标签（type/主题）
[分页区 Pager]
    ├─ 上一页｜页码｜下一页
[全局Footer]
```
- 详情页（/customs/:id）
```
[全局Header/Nav]
[返回按钮] ← 返回
[主标题 Title]
[元信息 Meta] dateRule · location
[标签 Tags]
[媒体画廊 MediaGallery]（图片若有；支持灯箱）
[视频播放器 VideoPlayer]（若有）
[正文内容 Content]（Markdown 渲染）
[（可选）相关内容/链接]
[全局Footer]
```

2. 详细的模块功能说明
- 工具栏 Toolbar
  - 搜索框：支持标题/摘要/标签模糊检索；即时过滤
  - 月份选择：按 dateRule 中的月份匹配（字符串包含或预解析）
  - 季节选择：春/夏/秋/冬（或“全年”），按字段 season 过滤
  - 类型选择：按 tags 中的类型过滤（如“庙会”“庆典”“祭祀”等）
  - 排序：按时间（月份）、标题（拼音/中文）、热度（预留）等排序规则
- 列表卡片 Card
  - 封面图：占位图或数据提供的缩略图
  - 标题：突出显示
  - 基础信息：dateRule（如“每年正月十五”）· location（地点）
  - 标签：展示 2–4 个关键词；过多可折叠
  - 点击卡片：进入详情页
- 分页/空状态
  - 分页：上一页/下一页；每页 6–12 条可配置
  - 空状态：展示提示文案与“清空筛选”快捷入口
- 详情页模块
  - 返回按钮：返回上一页面
  - 标题与元信息：统一排版层级
  - 标签：同列表风格
  - 媒体画廊：可点击放大预览（灯箱），支持 ESC/左右方向键
  - 视频播放器：可选 poster、字幕、播放控制
  - 正文：Markdown 渲染，支持基本排版（h1–h3、列表、图片、引用等）
- 数据与内容
  - 数据源：/public/data/customs.json（列表与详情字段）
  - 正文内容：/content/customs/*.md（详情页，按文件路径加载）

3. 交互流程描述
- 搜索/筛选
  - 用户输入关键词或选择月份/季节/类型 → 触发本地过滤 → 列表即时刷新
  - 建议将状态同步到 URL Query（如 ?q=&month=&season=&type=），便于刷新/分享后还原
- 排序
  - 用户选择排序项 → 使用 localeCompare（zh-Hans-CN）或自定义权重进行排序 → 列表重排
- 分页
  - 点击分页按钮 → 更新当前页码 → 滚动至列表顶部（或保持位置，遵循评审决定）
- 路由
  - 列表卡片点击 → 跳转至 /customs/:id → 加载数据及 Markdown → 渲染媒体与正文
  - 详情页“返回” → 回到列表页（如启用 URL Query 同步，可恢复筛选与页码）
- 媒体与灯箱
  - 点击图片 → 打开灯箱 → 支持 ESC 关闭、左右切换、点击遮罩关闭
  - 视频播放 → 贴合浏览器原生控制，支持键盘空格暂停/播放

4. 视觉设计规范要求
- 颜色
  - 文字主色：#2c3e50；次级文字：#64748b / #6b7280 / #94a3b8
  - 边框：#e5e7eb / #eee；强调/链接：#3b82f6
  - 标签底色：#f1f5f9；卡片悬浮阴影：rgba(0,0,0,.06)
- 字体与字号
  - 全局跟随 App.vue（系统无衬线）
  - 列表标题：16px / 700；摘要（若有）：13px / 行高 1.5
  - 详情标题：24px / 800；元信息：12–14px / 中灰
  - 标签：12px
- 布局与间距
  - 页面内边距：24px；工具栏间距：8px（flex-wrap 自动换行）
  - 网格列：<768px 1列；≥768px 2列；≥1024px 3列
  - 卡片：圆角 10px、内边距 12px；封面高度 160px，object-fit: cover
  - 灯箱：居中显示，暗色遮罩 0.6；图片圆角 10px
- 交互状态
  - 按钮禁用：opacity: 0.5；cursor: not-allowed
  - 卡片 hover：轻微上移 2px + 阴影增强
  - 输入/选择控件：高度 36px；focus 边框高亮；placeholder 中灰
- 图像与媒体
  - 封面/画廊图片提供 alt 文本；建议使用 WebP 并保留后备格式
  - 视频 poster 建议与封面统一风格；字幕文件可选

（以上规划为界面与交互层面的审核依据；若确认无误，我将按此规范推进组件与路由的具体开发实现。）