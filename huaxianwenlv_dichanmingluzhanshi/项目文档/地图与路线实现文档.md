# 地图与路线（/map，可选）实现文档

## 1. 页面功能描述
- 使用 Leaflet 展示非遗与风俗的地理位置点位
- 支持按分类/标签显示与隐藏
- 点击 Marker 弹出信息卡，跳转详情页

## 2. 核心实现逻辑

### 2.1 地图初始化与图层
```javascript
import L from 'leaflet'

const map = L.map('map').setView([30.12, 120.12], 10)
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '© OpenStreetMap' }).addTo(map)

const heritageLayer = L.layerGroup().addTo(map)
const customsLayer = L.layerGroup().addTo(map)

L.control.layers(null, { '非遗': heritageLayer, '风俗': customsLayer }).addTo(map)
```

### 2.2 加载点位与交互
```javascript
const loadMarkers = async () => {
  const [heritage, customs] = await Promise.all([
    fetch('/data/heritage.json').then(r => r.json()),
    fetch('/data/customs.json').then(r => r.json())
  ])

  heritage.filter(h => h.location).forEach(h => {
    const m = L.marker([h.location.lat, h.location.lng]).addTo(heritageLayer)
    m.bindPopup(`<b>${h.title}</b><br>${h.region}`)
    m.on('click', () => router.push(`/heritage/${h.id}`))
  })

  customs.filter(c => c.locationLatLng).forEach(c => {
    const m = L.marker(c.locationLatLng).addTo(customsLayer)
    m.bindPopup(`<b>${c.title}</b><br>${c.location}`)
    m.on('click', () => router.push(`/customs/${c.id}`))
  })
}
```

## 3. 关键代码片段

```vue
<template>
  <div class="h-[calc(100vh-80px)]">
    <div id="map" class="w-full h-full"></div>
  </div>
</template>

<script setup>
import { onMounted } from 'vue'

onMounted(() => {
  // 地图初始化与点位加载
})
</script>
```

## 4. 依赖关系说明
- 数据：/public/data/heritage.json（含 location 字段）、/public/data/customs.json（可扩展字段）
- 库：leaflet
- 路由：点击 Marker 跳转对应详情页

## 5. 注意事项
- 离线或接口失败时给出提示并隐藏地图
- 移动端需优化交互（禁用双指外的手势缩放可选）
- 性能：大量点位考虑聚合（MarkerCluster，可选）
- 无障碍：提供地图描述文本与跳转列表的可访问替代